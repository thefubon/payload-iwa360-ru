# üì¶ Database Migrations

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ production

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Vercel Postgres Dashboard (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç –Ω–∞ [Vercel Dashboard](https://vercel.com/dashboard)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Storage** ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à—É PostgreSQL –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
3. –ù–∞–∂–º–∏—Ç–µ **"Query"** –∏–ª–∏ **".sql"** –≤–∫–ª–∞–¥–∫—É
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ `update-schema-2025-10-06.sql`
5. –ù–∞–∂–º–∏—Ç–µ **"Run Query"**
6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ psql (–¥–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö)

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–π production –ë–î
psql "postgresql://user:password@host:port/database"

# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é
\i migrations/update-schema-2025-10-06.sql

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
\d home_page
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Payload (—Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

‚ö†Ô∏è **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ production!**

–í `payload.config.ts` —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `push: true`, —á—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ `pnpm dev`.

–î–ª—è production –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä—É—á–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–í–∞—Ä–∏–∞–Ω—Ç 1 –∏–ª–∏ 2).

## –°–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π

### 2025-10-06: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –±–æ–∫–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã + —Ä–æ–ª—å Viewer

**–§–∞–π–ª:** `update-schema-2025-10-06.sql`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã 12 –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π –≤ `home_page`:
   - `decorative_line_settings_left_offset_mobile`
   - `decorative_line_settings_left_offset_sm`
   - `decorative_line_settings_left_offset_md`
   - `decorative_line_settings_left_offset_lg`
   - `decorative_line_settings_left_offset_xl`
   - `decorative_line_settings_left_offset2xl`
   - `decorative_line_settings_right_offset_mobile`
   - `decorative_line_settings_right_offset_sm`
   - `decorative_line_settings_right_offset_md`
   - `decorative_line_settings_right_offset_lg`
   - `decorative_line_settings_right_offset_xl`
   - `decorative_line_settings_right_offset2xl`

2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `'viewer'` –≤ enum `enum_users_role`

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –¢—Ä–µ–±—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞ production

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'home_page' 
AND column_name LIKE '%offset%'
ORDER BY column_name;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ enum –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è —Ä–æ–ª–µ–π
SELECT enumlabel 
FROM pg_enum 
WHERE enumtypid = (SELECT oid FROM pg_type WHERE typname = 'enum_users_role')
ORDER BY enumsortorder;
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
- –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è 12 –Ω–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ —Å —Ç–∏–ø–æ–º `numeric`
- –í enum –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è: `admin`, `user`, `editor`, `viewer`

## –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ (Rollback)

‚ö†Ô∏è **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å—é!**

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –±–ª–æ–∫ `ROLLBACK` –≤ —Ñ–∞–π–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

**–í–∞–∂–Ω–æ:** PostgreSQL –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–∞–ª—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ enum –±–µ–∑ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏—è —Ç–∏–ø–∞. –ï—Å–ª–∏ –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ —Ä–æ–ª—å `viewer`, –æ—Ç–∫–∞—Ç –±—É–¥–µ—Ç —Å–ª–æ–∂–Ω—ã–º.

## –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (TODO)

–í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑:
- GitHub Actions
- Vercel Deploy Hooks
- Custom migration runner

## üÜò –ü–æ–º–æ—â—å

–ï—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∞—Å—å:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ PostgreSQL
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ö–µ–º—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –ø–æ –æ–¥–Ω–æ–π

